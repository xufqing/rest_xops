(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-2e75"],{"18Lb":function(t,e,n){"use strict";var o=n("VCwG");n.n(o).a},JNL0:function(t,e,n){"use strict";n.d(e,"a",function(){return i}),n.d(e,"d",function(){return r}),n.d(e,"b",function(){return s}),n.d(e,"c",function(){return a});var o=n("t3Un");function i(t){return Object(o.a)({url:"api/projects/",method:"post",data:t})}function r(t){return Object(o.a)({url:"api/projects/"+t+"/",method:"get"})}function s(t){return Object(o.a)({url:"api/projects/"+t+"/",method:"delete"})}function a(t,e){return Object(o.a)({url:"api/projects/"+t+"/",method:"put",data:e})}},KKfI:function(t,e,n){"use strict";n.r(e);var o=n("FyfS"),i=n.n(o),r=n("Kw5r"),s=n("Qdvm"),a=n("7Qib"),c=n("X4fA"),l=n("qpgI"),u=n("JNL0"),p=n("tAjd"),d=n.n(p),f={data:function(){return{ico:"unlock",unlock:!0,content:"锁定滚动条",height:document.documentElement.clientHeight-94.5+"px;",width:document.documentElement.clientWidth-185+"px;",startloading:!1,stoploading:!1,tailloading:!1,servers:"",project_data:{server_ids:""},hosts:[],log_data:{server_ids:""},data:[],vm:null,rules:{server_ids:[{required:!0,message:"请选择服务器",trigger:"blur"}]}}},watch:{data:{handler:function(t,e){var n=this;this.$nextTick(function(){if(n.unlock){var t=document.getElementById("console");t.scrollTop=t.scrollHeight}})}}},created:function(){var t=this;this.init(),setTimeout(function(){Object(l.c)("Linux").then(function(e){var n=t.servers.split(","),o=t.hosts,r=t.project_data,s=t.log_data;e.forEach(function(t,e){var r=!0,s=!1,a=void 0;try{for(var c,l=i()(n);!(r=(c=l.next()).done);r=!0){c.value===t.key&&o.push(t)}}catch(t){s=!0,a=t}finally{try{!r&&l.return&&l.return()}finally{if(s)throw a}}}),r.server_ids=n[0],s.server_ids=n[0]})},200)},mounted:function(){this.initWebSocket(),this.start()},beforeDestroy:function(){this.vm.$disconnect(),console.log("---离开页面关闭Websocket---")},methods:{parseTime:a.b,initWebSocket:function(){var t="ws://"+"http://demo.xufqing.cn".replace(/http:\/\//,"")+"/websocket/console?token="+Object(c.a)();r.default.use(d.a,t,{connectManually:!0,reconnection:!0,reconnectionAttempts:5,reconnectionDelay:3e3}),this.vm=new r.default,this.vm.$connect(),console.log("---连接Websocket----")},init:function(){var t=this;Object(u.d)(this.$route.query.id).then(function(e){t.project_data.app_start=e.app_start,t.project_data.app_stop=e.app_stop,t.project_data.app_bin_path=e.app_bin_path,t.project_data.server_ids=e.server_ids,t.servers=e.server_ids,t.log_data.app_log_file=e.app_log_file,t.log_data.server_ids=e.server_ids})},start:function(){var t=this;this.$socket.onopen=function(e){1===e.target.readyState&&(console.log("--------正在读取数据!--------"),t.$socket.onmessage=function(e){var n=t.getColor(e.data);t.data.push(n)})}},doStart:function(){var t=this;this.$refs.project.validate(function(e){if(!e)return!1;t.startloading=!0;var n={excu:"app_start",host:t.project_data.server_ids,app_start:t.project_data.app_start};Object(s.a)(n).then(function(e){t.startloading=!1}).catch(function(e){t.startloading=!1,console.log(e)})})},doStop:function(){var t=this;this.$refs.project.validate(function(e){if(!e)return!1;t.stoploading=!0;var n={excu:"app_stop",host:t.project_data.server_ids,app_stop:t.project_data.app_stop};Object(s.a)(n).then(function(e){t.stoploading=!1}).catch(function(e){t.stoploading=!1,console.log(e)})})},doTailStart:function(){var t=this;this.$refs.log.validate(function(e){if(!e)return!1;t.tailloading=!0;var n={excu:"tail_start",host:t.log_data.server_ids,app_log_file:t.log_data.app_log_file};Object(s.a)(n).then(function(e){t.tailloading=!1}).catch(function(e){t.tailloading=!1,console.log(e)})})},doTailStop:function(){var t=this;this.$refs.log.validate(function(e){if(!e)return!1;Object(s.a)({excu:"tail_stop"}).then(function(e){t.$message({showClose:!0,type:"success",message:"执行成功!请等待线程结束.",duration:3500})}).catch(function(e){t.tailloading=!1,console.log(e)})})},closeTag:function(){var t=this;this.$confirm("是否关闭页面并返回上一页?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.vm.$disconnect(),t.$router.go(-1),t.$store.dispatch("delView",t.$store.state.tagsView.visitedViews.slice(-1)[0])}).catch(function(){t.$message({type:"info",message:"取消操作"})})},getColor:function(t){var e=t.match(/INFO/i),n=t.match(/WARN/i),o=t.match(/DEBUG/i),i=t.match(/\[(.*?)@(.*?)\]/),r=t.match(/ERROR/i);return e?t.replace(/INFO/i,'<span style="color: #7FFF00;">'+e+"</span>"):n?t.replace(/WARN/i,'<span style="color: #FFFF00;">'+n+"</span>"):o?t.replace(/DEBUG/i,'<span style="color: #0000ff;">'+o+"</span>"):i?t.replace(/\[(.*?)@(.*?)\]/,'<span style="color: #FFA54F;">'+i[0]+"</span>"):r?t.replace(/ERROR/i,'<span style="color: #FF0000;">'+r+"</span>"):t},doLock:function(){this.unlock?(this.content="解除锁定",this.ico="lock"):(this.content="锁定滚动条",this.ico="unlock"),this.unlock=!this.unlock}}},h=(n("18Lb"),n("KHd+")),v=Object(h.a)(f,function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"container",style:"width:"+t.width},[n("el-row",{attrs:{gutter:32}},[n("el-col",{attrs:{span:10}},[n("el-card",{staticClass:"box-card"},[n("span",[t._v("项目管理")]),t._v(" "),n("el-form",{ref:"project",attrs:{model:t.project_data,rules:t.rules,size:"small","label-width":"80px"}},[n("el-form-item",{attrs:{label:"服务器",prop:"server_ids"}},[n("el-select",{attrs:{placeholder:"请选择服务器"},model:{value:t.project_data.server_ids,callback:function(e){t.$set(t.project_data,"server_ids",e)},expression:"project_data.server_ids"}},t._l(t.hosts,function(t){return n("el-option",{key:t.key,attrs:{label:t.label,value:t.key}})}))],1),t._v(" "),n("el-form-item",[n("div",{staticStyle:{display:"inline-block",margin:"0px 1px"}},[n("el-button",{attrs:{loading:t.startloading,size:"mini",type:"success",icon:"el-icon-share"},on:{click:t.doStart}},[t._v("启动")]),t._v(" "),n("el-button",{attrs:{loading:t.stoploading,size:"mini",type:"primary",icon:"el-icon-plus"},on:{click:t.doStop}},[t._v("停止")])],1)])],1)],1)],1),t._v(" "),n("el-col",{attrs:{span:14}},[n("el-card",{staticClass:"box-card"},[n("span",[t._v("日志管理")]),t._v(" "),n("el-form",{ref:"log",attrs:{model:t.log_data,rules:t.rules,size:"small","label-width":"80px"}},[n("el-form-item",{attrs:{label:"服务器",prop:"server_ids"}},[n("el-select",{attrs:{placeholder:"请选择服务器"},model:{value:t.log_data.server_ids,callback:function(e){t.$set(t.log_data,"server_ids",e)},expression:"log_data.server_ids"}},t._l(t.hosts,function(t){return n("el-option",{key:t.key,attrs:{label:t.label,value:t.key}})}))],1),t._v(" "),n("el-form-item",[n("div",{staticStyle:{display:"inline-block",margin:"0px 1px"}},[n("el-button",{attrs:{loading:t.tailloading,size:"mini",type:"success",icon:"el-icon-share"},on:{click:t.doTailStart}},[t._v("启动")]),t._v(" "),n("el-button",{attrs:{size:"mini",type:"primary",icon:"el-icon-plus"},on:{click:t.doTailStop}},[t._v("停止")])],1)])],1)],1)],1)],1),t._v(" "),n("el-card",{staticClass:"box-card"},[n("el-tooltip",{staticClass:"closepage item",attrs:{content:"返回上一页",effect:"dark",placement:"left"}},[n("el-button",{attrs:{type:"info",size:"mini",circle:""},on:{click:t.closeTag}},[n("svg-icon",{attrs:{"icon-class":"return"}})],1)],1),t._v(" "),n("el-tooltip",{staticClass:"lock item",attrs:{content:t.content,effect:"dark",placement:"left"}},[n("el-button",{attrs:{type:"info",size:"mini",circle:""},on:{click:t.doLock}},[n("svg-icon",{attrs:{"icon-class":t.ico}})],1)],1),t._v(" "),n("div",{staticClass:"console",style:"height:"+t.height,attrs:{id:"console"}},t._l(t.data,function(e){return n("div",{key:e.id},[n("span",{staticClass:"line-html",domProps:{innerHTML:t._s(e)}})])}))],1)],1)},[],!1,null,"f1557066",null);v.options.__file="tools.vue";e.default=v.exports},Qdvm:function(t,e,n){"use strict";n.d(e,"a",function(){return i}),n.d(e,"b",function(){return r});var o=n("t3Un");function i(t){return Object(o.a)({url:"api/deploy/excu/",method:"post",data:t})}function r(t){return Object(o.a)({url:"api/deploy/ver/?id="+t,method:"get"})}},VCwG:function(t,e,n){},qpgI:function(t,e,n){"use strict";n.d(e,"c",function(){return i}),n.d(e,"d",function(){return r}),n.d(e,"a",function(){return s}),n.d(e,"b",function(){return a});var o=n("t3Un");function i(t){return t?Object(o.a)({url:"api/device/list/?os_type="+t,method:"get"}):Object(o.a)({url:"api/device/list/",method:"get"})}function r(t){return Object(o.a)({url:"api/devices/"+t+"/",method:"get"})}function s(t){return Object(o.a)({url:"api/devices/"+t+"/",method:"delete"})}function a(t,e){return Object(o.a)({url:"api/devices/"+t+"/",method:"put",data:e})}},tAjd:function(t,e,n){"undefined"!=typeof self&&self,t.exports=function(t){function e(o){if(n[o])return n[o].exports;var i=n[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,o){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:o})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=1)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),i=function(){function t(){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.listeners=new Map}return o(t,[{key:"addListener",value:function(t,e,n){return"function"==typeof e&&(this.listeners.has(t)||this.listeners.set(t,[]),this.listeners.get(t).push({callback:e,vm:n}),!0)}},{key:"removeListener",value:function(t,e,n){var o=this.listeners.get(t),i=void 0;return!!(o&&o.length&&(i=o.reduce(function(t,o,i){return"function"==typeof o.callback&&o.callback===e&&o.vm===n&&(t=i),t},-1))>-1)&&(o.splice(i,1),this.listeners.set(t,o),!0)}},{key:"emit",value:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];var i=this.listeners.get(t);return!(!i||!i.length||(i.forEach(function(t){var e;(e=t.callback).call.apply(e,[t.vm].concat(n))}),0))}}]),t}();e.default=new i},function(t,e,n){t.exports=n(2)},function(t,e,n){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),r=o(i),s=n(0),a=o(s);e.default={install:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)throw new Error("[vue-native-socket] cannot locate connection");var o=null;n.$setInstance=function(e){t.prototype.$socket=e},n.connectManually?(t.prototype.$connect=function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n;o=new r.default(i,s),t.prototype.$socket=o.WebSocket},t.prototype.$disconnect=function(){o&&o.reconnection&&(o.reconnection=!1),t.prototype.$socket&&(t.prototype.$socket.close(),delete t.prototype.$socket)}):(o=new r.default(e,n),t.prototype.$socket=o.WebSocket);var i="undefined"!=typeof Proxy&&"function"==typeof Proxy&&/native code/.test(Proxy.toString());t.mixin({created:function(){var t=this,e=this,n=this.$options.sockets;i?(this.$options.sockets=new Proxy({},{set:function(t,n,o){return a.default.addListener(n,o,e),t[n]=o,!0},deleteProperty:function(t,n){return a.default.removeListener(n,e.$options.sockets[n],e),delete t.key,!0}}),n&&Object.keys(n).forEach(function(e){t.$options.sockets[e]=n[e]})):Object.seal(this.$options.sockets)},beforeDestroy:function(){var t=this;if(i){var e=this.$options.sockets;e&&Object.keys(e).forEach(function(e){delete t.$options.sockets[e]})}}})}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),i=n(0),r=function(t){return t&&t.__esModule?t:{default:t}}(i),s=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.format=n.format&&n.format.toLowerCase(),e.startsWith("//")&&(e=("https:"===window.location.protocol?"wss":"ws")+"://"+e),this.connectionUrl=e,this.opts=n,this.reconnection=this.opts.reconnection||!1,this.reconnectionAttempts=this.opts.reconnectionAttempts||1/0,this.reconnectionDelay=this.opts.reconnectionDelay||1e3,this.reconnectTimeoutId=0,this.reconnectionCount=0,this.passToStoreHandler=this.opts.passToStoreHandler||!1,this.connect(e,n),n.store&&(this.store=n.store),n.mutations&&(this.mutations=n.mutations),this.onEvent()}return o(t,[{key:"connect",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=n.protocol||"";return this.WebSocket=n.WebSocket||(""===o?new WebSocket(t):new WebSocket(t,o)),"json"===this.format&&("sendObj"in this.WebSocket||(this.WebSocket.sendObj=function(t){return e.WebSocket.send(JSON.stringify(t))})),this.WebSocket}},{key:"reconnect",value:function(){var t=this;this.reconnectionCount<=this.reconnectionAttempts?(this.reconnectionCount++,clearTimeout(this.reconnectTimeoutId),this.reconnectTimeoutId=setTimeout(function(){t.store&&t.passToStore("SOCKET_RECONNECT",t.reconnectionCount),t.connect(t.connectionUrl,t.opts),t.onEvent()},this.reconnectionDelay)):this.store&&this.passToStore("SOCKET_RECONNECT_ERROR",!0)}},{key:"onEvent",value:function(){var t=this;["onmessage","onclose","onerror","onopen"].forEach(function(e){t.WebSocket[e]=function(n){r.default.emit(e,n),t.store&&t.passToStore("SOCKET_"+e,n),t.reconnection&&"onopen"===e&&(t.opts.$setInstance(n.currentTarget),t.reconnectionCount=0),t.reconnection&&"onclose"===e&&t.reconnect()}})}},{key:"passToStore",value:function(t,e){this.passToStoreHandler?this.passToStoreHandler(t,e,this.defaultPassToStore.bind(this)):this.defaultPassToStore(t,e)}},{key:"defaultPassToStore",value:function(t,e){if(t.startsWith("SOCKET_")){var n="commit",o=t.toUpperCase(),i=e;"json"===this.format&&e.data&&((i=JSON.parse(e.data)).mutation?o=[i.namespace||"",i.mutation].filter(function(t){return!!t}).join("/"):i.action&&(n="dispatch",o=[i.namespace||"",i.action].filter(function(t){return!!t}).join("/"))),this.mutations&&(o=this.mutations[o]||o),this.store[n](o,i)}}}]),t}();e.default=s}])}}]);